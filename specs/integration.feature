Feature: MCPクライアント-サーバー統合
  開発者として
  完全なMCPクライアント-サーバー接続を確立したい
  メッセージを交換し、機能にアクセスするため

  Background:
    Given リソースとツール機能を持つサーバーがある
    And それらの機能をサポートするクライアントがある
    And 両方に適切なトランスポートがある

  Scenario: 完全な接続ライフサイクル
    When サーバーをそのトランスポートに接続する
    And クライアントをそのトランスポートに接続する
    Then クライアントとサーバーは初期化プロセスを完了すべき
    And クライアントは利用可能なリソースを一覧表示できるべき
    And クライアントは利用可能なツールを一覧表示できるべき
    When クライアントを切断する
    And サーバーを切断する
    Then 両方の接続が適切に閉じられるべき
    And すべてのリソースがクリーンアップされるべき

  Scenario: リアルタイム更新付きリソース処理
    Given 接続されたクライアントとサーバーがある
    And 動的リソースを持つサーバーがある
    When クライアントが利用可能なリソースを一覧表示する
    Then サーバーはリソース情報を返すべき
    When クライアントがリソースを購読する
    And クライアントがリソースの内容を読み取る
    Then サーバーは現在の内容を返すべき
    When サーバー上でリソースが更新される
    Then サーバーは通知を送信すべき
    And クライアントは通知を受信すべき
    When クライアントが再度リソースを読み取る
    Then サーバーは更新された内容を返すべき
    When クライアントがリソースの購読を解除する
    And リソースが再度更新される
    Then クライアントに通知は送信されるべきでない

  Scenario: ツール実行ライフサイクル
    Given 接続されたクライアントとサーバーがある
    And 登録済みツールを持つサーバーがある
    When クライアントが利用可能なツールを一覧表示する
    Then サーバーはツール情報を返すべき
    When クライアントが有効な引数でツールを呼び出す
    Then サーバーはツールを実行すべき
    And サーバーは結果を返すべき
    When サーバーが新しいツールを追加する
    Then サーバーは通知を送信すべき
    And クライアントは通知を受信すべき
    When クライアントが再度ツールを一覧表示する
    Then サーバーは両方のツールを返すべき
